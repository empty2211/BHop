--by squirt--by squirt --by squirt--by squirt--by squirt
--by squirt--by squirt--by squirt--by squirt--by squirt
--by squirt--by squirt--by squirt--by squirt--by squirt
--by squirt--by squirt--by squirt --by squirt--by squirt
local Player = game:GetService("Players").LocalPlayer
local UIS = game:GetService("UserInputService")
--by squirt--by squirt --by squirt --by squirt --by squirt
local Character
local Humanoid
local RootPart
--by squirt--by squirt --by squirt --by squirt --by squirt
local Settings = {
    Enabled = false,
    BaseSpeed = 16,
    CurrentSpeed = 16,
    MaxSpeed = 1000,
    SpeedIncrease = 50,
    JumpPower = 50,
    MinJumpPower = 0,
    MaxJumpPower = 1000,
    MinMaxSpeed = 1,
    MaxMaxSpeed = 10000,
    MinSpeedIncrease = 1,
    MaxSpeedIncrease = 1000
}
--by squirt
local Original = {
    WalkSpeed = 16,
    JumpPower = 50
}
--by squirt--by squirt --by squirt --by squirt --by squirt --by squirt
local lastJump = tick()
local isOnGround = false
local connection
local screenGui
local mainFrame
local titleBar
local titleText
local collapseButton
local contentFrame
local button
local speedBar
local speedText
local jumpHandle, jumpValueText
local maxHandle, maxValueText
local accelHandle, accelValueText
local dragging = false
local dragThreshold = 10
local touchStartPos
local sliderDragging = false
local sliderStartPos
local sliderStartValue
local currentSlider = nil
local menuCollapsed = false
--by squirt --by squirt --by squirt --by squirt --by squirt --by squirt --by squirt --by squirt
local lastPosition
local lastTime
local realSpeed = 0
local peakSpeed = 0
--by squirt
local EXPANDED_HEIGHT = 210
local COLLAPSED_HEIGHT = 30

-- ========== Функции BHop ==========

local function updateCharacterReferences()
    Character = Player.Character
    if Character then
        Humanoid = Character:FindFirstChildOfClass("Humanoid")
        RootPart = Character:FindFirstChild("HumanoidRootPart")
        if Humanoid and RootPart then
            Original.WalkSpeed = Humanoid.WalkSpeed
            Original.JumpPower = Humanoid.JumpPower
            Settings.BaseSpeed = Original.WalkSpeed
            Settings.CurrentSpeed = Settings.BaseSpeed
            lastPosition = RootPart.Position
            lastTime = tick()
            peakSpeed = 0
            return true
        end
    end
    return false
end
--by squirt
if not updateCharacterReferences() then
    Player.CharacterAdded:Connect(function(char)
        Character = char
        task.wait(0.5)
        updateCharacterReferences()
    end)
end

local function isOnGroundCheck()
    if not RootPart then return false end
    local rayOrigin = RootPart.Position
    local rayDirection = Vector3.new(0, -4, 0)
    local raycastParams = RaycastParams.new()
    raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
    raycastParams.FilterDescendantsInstances = {Character}
    local result = workspace:Raycast(rayOrigin, rayDirection, raycastParams)
    return result ~= nil
end
--by squirt
local function performJump()
    if not Settings.Enabled or tick() - lastJump < 0.1 then return end
    if isOnGround and Humanoid then
        pcall(function()
            Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
        end)
        lastJump = tick()
        Settings.CurrentSpeed = math.min(
            Settings.CurrentSpeed + Settings.SpeedIncrease,
            Settings.MaxSpeed
        )
        Humanoid.WalkSpeed = Settings.CurrentSpeed
    end
end
--by squirt
local function updateRealSpeed()
    if not RootPart then return end
    local currentTime = tick()
    local deltaTime = currentTime - lastTime
    if deltaTime > 0 then
        local currentPos = RootPart.Position
        local deltaPos = currentPos - lastPosition
        local horizontalDelta = Vector3.new(deltaPos.X, 0, deltaPos.Z)
        realSpeed = horizontalDelta.Magnitude / deltaTime
        lastPosition = currentPos
        lastTime = currentTime
        if realSpeed > peakSpeed then
            peakSpeed = realSpeed
        end
    end
end
--by squirt
local function mainLoop()
    if not Character or not Humanoid or Humanoid.Health <= 0 then
        if Settings.Enabled then
            Settings.Enabled = false
            if button then
                button.Text = "BHop OFF"
                button.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
            end
        end
        return
    end
    
    updateRealSpeed()
    isOnGround = isOnGroundCheck()
    
    if Settings.Enabled then
        performJump()
    end
--by squirt    
    if Settings.Enabled and not isOnGround then
        Settings.CurrentSpeed = math.max(
            Settings.CurrentSpeed - 0.5,
            Settings.BaseSpeed
        )
        Humanoid.WalkSpeed = Settings.CurrentSpeed
    end
--by squirt
    if speedBar then
        local percent = (peakSpeed > 0) and math.min(realSpeed / peakSpeed, 1) or 0
        speedBar.Size = UDim2.new(percent, 0, 1, 0)
    end
    if speedText then
        speedText.Text = string.format("Speed: %.1f (peak: %.1f)", realSpeed, peakSpeed)
    end
end
--by squirt
local function toggleBHop()
    if not Humanoid then return end
    Settings.Enabled = not Settings.Enabled
    --by squirt
    if Settings.Enabled then
        print("[BHop] Включен")
        Humanoid.JumpPower = Settings.JumpPower
        Humanoid.WalkSpeed = Settings.CurrentSpeed
        if button then
            button.Text = "BHop ON"
            button.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        end
        if not connection then
            connection = game:GetService("RunService").Heartbeat:Connect(mainLoop)
        end
    else
        print("[BHop] Выключен")
        Humanoid.WalkSpeed = Original.WalkSpeed
        Humanoid.JumpPower = Original.JumpPower
        Settings.CurrentSpeed = Original.WalkSpeed
        if button then
            button.Text = "BHop OFF"
            button.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        end
    end
end
--by squirt
local function setJumpPower(value)
    if not Humanoid then return end
    value = math.clamp(value, Settings.MinJumpPower, Settings.MaxJumpPower)
    Settings.JumpPower = value
    if Settings.Enabled then
        Humanoid.JumpPower = value
    end --by squirt
    if jumpValueText then
        jumpValueText.Text = tostring(math.floor(value))
    end
    if jumpHandle then
        local percent = (value - Settings.MinJumpPower) / (Settings.MaxJumpPower - Settings.MinJumpPower)
        jumpHandle.Position = UDim2.new(percent, -7.5, 0, -5)
    end
end
--by squirt
local function setMaxSpeed(value)
    value = math.clamp(value, Settings.MinMaxSpeed, Settings.MaxMaxSpeed)
    Settings.MaxSpeed = value
    if Settings.CurrentSpeed > value then
        Settings.CurrentSpeed = value
        if Settings.Enabled and Humanoid then
            Humanoid.WalkSpeed = value
        end
    end
    if maxValueText then
        maxValueText.Text = tostring(math.floor(value))
    end
    if maxHandle then
        local percent = (value - Settings.MinMaxSpeed) / (Settings.MaxMaxSpeed - Settings.MinMaxSpeed)
        maxHandle.Position = UDim2.new(percent, -7.5, 0, -5)
    end
end

local function setSpeedIncrease(value)
    value = math.clamp(value, Settings.MinSpeedIncrease, Settings.MaxSpeedIncrease)
    Settings.SpeedIncrease = value
    if accelValueText then
        accelValueText.Text = tostring(math.floor(value))
    end
    if accelHandle then
        local percent = (value - Settings.MinSpeedIncrease) / (Settings.MaxSpeedIncrease - Settings.MinSpeedIncrease)
        accelHandle.Position = UDim2.new(percent, -7.5, 0, -5)
    end
end

local function toggleCollapse()
    menuCollapsed = not menuCollapsed
    if menuCollapsed then
        mainFrame.Size = UDim2.new(0, 240, 0, COLLAPSED_HEIGHT)
        contentFrame.Visible = false
        collapseButton.Text = "▶"
    else
        mainFrame.Size = UDim2.new(0, 240, 0, EXPANDED_HEIGHT)
        contentFrame.Visible = true
        collapseButton.Text = "▼"
    end
end

-- ========== Создание главного меню BHop ==========

local function createGUI()
    if screenGui then
        screenGui:Destroy()
    end
    
    screenGui = Instance.new("ScreenGui")
    screenGui.Name = "SquirtMenu BHop"
    screenGui.Parent = Player:WaitForChild("PlayerGui")
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.DisplayOrder = 1000

    mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, 240, 0, EXPANDED_HEIGHT)
    mainFrame.Position = UDim2.new(0, 20, 0.5, -105)
    mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    mainFrame.BackgroundTransparency = 0.3
    mainFrame.BorderSizePixel = 2
    mainFrame.BorderColor3 = Color3.new(0, 0, 0)
    mainFrame.Parent = screenGui
    mainFrame.Active = true
    mainFrame.Draggable = false
--by squirt
    titleBar = Instance.new("Frame")
    titleBar.Size = UDim2.new(1, 0, 0, 30)
    titleBar.Position = UDim2.new(0, 0, 0, 0)
    titleBar.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    titleBar.BackgroundTransparency = 0.2
    titleBar.BorderSizePixel = 1
    titleBar.BorderColor3 = Color3.new(0, 0, 0)
    titleBar.Parent = mainFrame

    titleText = Instance.new("TextLabel")
    titleText.Size = UDim2.new(0, 150, 1, 0)
    titleText.Position = UDim2.new(0, 5, 0, 0)
    titleText.BackgroundTransparency = 1
    titleText.Text = "SquirtMenu BHop"
    titleText.TextColor3 = Color3.fromRGB(200, 255, 200)
    titleText.Font = Enum.Font.GothamBold
    titleText.TextSize = 14
    titleText.TextXAlignment = Enum.TextXAlignment.Left
    titleText.Parent = titleBar

    collapseButton = Instance.new("TextButton")
    collapseButton.Size = UDim2.new(0, 30, 1, 0)
    collapseButton.Position = UDim2.new(1, -35, 0, 0)
    collapseButton.BackgroundTransparency = 1
    collapseButton.Text = "▼"
    collapseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    collapseButton.Font = Enum.Font.GothamBold
    collapseButton.TextSize = 18
    collapseButton.Parent = titleBar
    collapseButton.AutoButtonColor = false

    contentFrame = Instance.new("Frame")
    contentFrame.Size = UDim2.new(1, 0, 1, -30)
    contentFrame.Position = UDim2.new(0, 0, 0, 30)
    contentFrame.BackgroundTransparency = 1
    contentFrame.Parent = mainFrame

    button = Instance.new("TextButton")
    button.Size = UDim2.new(1, -10, 0, 40)
    button.Position = UDim2.new(0, 5, 0, 5)
    button.Text = Settings.Enabled and "BHop ON" or "BHop OFF"
    button.BackgroundColor3 = Settings.Enabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
    button.TextColor3 = Color3.new(1, 1, 1)
    button.Font = Enum.Font.GothamBold
    button.TextSize = 18
    button.BorderSizePixel = 1
    button.BorderColor3 = Color3.new(0, 0, 0)
    button.Parent = contentFrame
    button.AutoButtonColor = false

    local speedFrame = Instance.new("Frame")
    speedFrame.Size = UDim2.new(1, -10, 0, 15)
    speedFrame.Position = UDim2.new(0, 5, 0, 50)
    speedFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    speedFrame.BorderSizePixel = 1
    speedFrame.Parent = contentFrame

    speedBar = Instance.new("Frame")
    speedBar.Size = UDim2.new(0, 0, 1, 0)
    speedBar.BackgroundColor3 = Color3.fromRGB(0, 255, 255)
    speedBar.BorderSizePixel = 0
    speedBar.Parent = speedFrame

    speedText = Instance.new("TextLabel")
    speedText.Size = UDim2.new(1, -10, 0, 15)
    speedText.Position = UDim2.new(0, 5, 0, 70)
    speedText.BackgroundTransparency = 1
    speedText.Text = "Speed: 0.0"
    speedText.TextColor3 = Color3.new(1, 1, 1)
    speedText.Font = Enum.Font.Gotham
    speedText.TextSize = 12
    speedText.TextXAlignment = Enum.TextXAlignment.Left
    speedText.Parent = contentFrame

    -- Jump
    local jumpLabel = Instance.new("TextLabel")
    jumpLabel.Size = UDim2.new(0, 50, 0, 15)
    jumpLabel.Position = UDim2.new(0, 5, 0, 95)
    jumpLabel.BackgroundTransparency = 1
    jumpLabel.Text = "Jump"
    jumpLabel.TextColor3 = Color3.new(1, 1, 1)
    jumpLabel.Font = Enum.Font.Gotham
    jumpLabel.TextSize = 12
    jumpLabel.TextXAlignment = Enum.TextXAlignment.Left
    jumpLabel.Parent = contentFrame

    jumpValueText = Instance.new("TextLabel")
    jumpValueText.Size = UDim2.new(0, 50, 0, 15)
    jumpValueText.Position = UDim2.new(1, -55, 0, 95)
    jumpValueText.BackgroundTransparency = 1
    jumpValueText.Text = tostring(math.floor(Settings.JumpPower))
    jumpValueText.TextColor3 = Color3.new(1, 1, 1)
    jumpValueText.Font = Enum.Font.Gotham
    jumpValueText.TextSize = 12
    jumpValueText.TextXAlignment = Enum.TextXAlignment.Right
    jumpValueText.Parent = contentFrame

    local jumpSliderBg = Instance.new("Frame")
    jumpSliderBg.Size = UDim2.new(1, -20, 0, 5)
    jumpSliderBg.Position = UDim2.new(0, 10, 0, 115)
    jumpSliderBg.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    jumpSliderBg.BorderSizePixel = 0
    jumpSliderBg.Parent = contentFrame

    jumpHandle = Instance.new("TextButton")
    jumpHandle.Size = UDim2.new(0, 15, 0, 15)
    jumpHandle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    jumpHandle.Text = ""
    jumpHandle.BorderSizePixel = 1
    jumpHandle.BorderColor3 = Color3.new(0, 0, 0)
    jumpHandle.Parent = jumpSliderBg
    jumpHandle.AutoButtonColor = false

    -- Max speed
    local maxLabel = Instance.new("TextLabel")
    maxLabel.Size = UDim2.new(0, 50, 0, 15)
    maxLabel.Position = UDim2.new(0, 5, 0, 130)
    maxLabel.BackgroundTransparency = 1
    maxLabel.Text = "Max speed"
    maxLabel.TextColor3 = Color3.new(1, 1, 1)
    maxLabel.Font = Enum.Font.Gotham
    maxLabel.TextSize = 12
    maxLabel.TextXAlignment = Enum.TextXAlignment.Left
    maxLabel.Parent = contentFrame
--by squirt
    maxValueText = Instance.new("TextLabel")
    maxValueText.Size = UDim2.new(0, 50, 0, 15)
    maxValueText.Position = UDim2.new(1, -55, 0, 130)
    maxValueText.BackgroundTransparency = 1
    maxValueText.Text = tostring(math.floor(Settings.MaxSpeed))
    maxValueText.TextColor3 = Color3.new(1, 1, 1)
    maxValueText.Font = Enum.Font.Gotham
    maxValueText.TextSize = 12
    maxValueText.TextXAlignment = Enum.TextXAlignment.Right
    maxValueText.Parent = contentFrame

    local maxSliderBg = Instance.new("Frame")
    maxSliderBg.Size = UDim2.new(1, -20, 0, 5)
    maxSliderBg.Position = UDim2.new(0, 10, 0, 150)
    maxSliderBg.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    maxSliderBg.BorderSizePixel = 0
    maxSliderBg.Parent = contentFrame

    maxHandle = Instance.new("TextButton")
    maxHandle.Size = UDim2.new(0, 15, 0, 15)
    maxHandle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    maxHandle.Text = ""
    maxHandle.BorderSizePixel = 1
    maxHandle.BorderColor3 = Color3.new(0, 0, 0)
    maxHandle.Parent = maxSliderBg
    maxHandle.AutoButtonColor = false
--by squirt
    -- Boost
    local accelLabel = Instance.new("TextLabel")
    accelLabel.Size = UDim2.new(0, 50, 0, 15)
    accelLabel.Position = UDim2.new(0, 5, 0, 165)
    accelLabel.BackgroundTransparency = 1
    accelLabel.Text = "boost"
    accelLabel.TextColor3 = Color3.new(1, 1, 1)
    accelLabel.Font = Enum.Font.Gotham
    accelLabel.TextSize = 12
    accelLabel.TextXAlignment = Enum.TextXAlignment.Left
    accelLabel.Parent = contentFrame

    accelValueText = Instance.new("TextLabel")
    accelValueText.Size = UDim2.new(0, 50, 0, 15)
    accelValueText.Position = UDim2.new(1, -55, 0, 165)
    accelValueText.BackgroundTransparency = 1
    accelValueText.Text = tostring(math.floor(Settings.SpeedIncrease))
    accelValueText.TextColor3 = Color3.new(1, 1, 1)
    accelValueText.Font = Enum.Font.Gotham
    accelValueText.TextSize = 12
    accelValueText.TextXAlignment = Enum.TextXAlignment.Right
    accelValueText.Parent = contentFrame

    local accelSliderBg = Instance.new("Frame")
    accelSliderBg.Size = UDim2.new(1, -20, 0, 5)
    accelSliderBg.Position = UDim2.new(0, 10, 0, 185)
    accelSliderBg.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    accelSliderBg.BorderSizePixel = 0
    accelSliderBg.Parent = contentFrame

    accelHandle = Instance.new("TextButton")
    accelHandle.Size = UDim2.new(0, 15, 0, 15)
    accelHandle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    accelHandle.Text = ""
    accelHandle.BorderSizePixel = 1
    accelHandle.BorderColor3 = Color3.new(0, 0, 0)
    accelHandle.Parent = accelSliderBg
    accelHandle.AutoButtonColor = false

    setJumpPower(Settings.JumpPower)
    setMaxSpeed(Settings.MaxSpeed)
    setSpeedIncrease(Settings.SpeedIncrease)

    -- Drag title bar
    local frameDragging = false
    local frameDragStart
    local frameStartPos

    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            frameDragging = true
            frameDragStart = Vector2.new(input.Position.X, input.Position.Y)
            frameStartPos = mainFrame.Position
        end
    end)

    titleBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            frameDragging = false
        end
    end)

    UIS.InputChanged:Connect(function(input, gameProcessed)
        if frameDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = Vector2.new(input.Position.X, input.Position.Y) - frameDragStart
            mainFrame.Position = UDim2.new(
                frameStartPos.X.Scale,
                frameStartPos.X.Offset + delta.X,
                frameStartPos.Y.Scale,
                frameStartPos.Y.Offset + delta.Y
            )
        end
    end)

    collapseButton.MouseButton1Click:Connect(toggleCollapse)

    -- BHop button click
    button.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            touchStartPos = Vector2.new(input.Position.X, input.Position.Y)
            dragging = false
        end
    end)

    button.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            if touchStartPos and not dragging then
                local delta = Vector2.new(input.Position.X, input.Position.Y) - touchStartPos
                if delta.Magnitude >= dragThreshold then
                    dragging = true
                end
            end
        end
    end)

    button.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            if not dragging then
                toggleBHop()
            end
            touchStartPos = nil
            dragging = false
        end
    end)

    -- Sliders
    local function startSlider(input, sliderType, startVal)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            sliderDragging = true
            currentSlider = sliderType
            sliderStartPos = Vector2.new(input.Position.X, input.Position.Y)
            sliderStartValue = startVal
        end
    end

    jumpHandle.InputBegan:Connect(function(input)
        startSlider(input, "jump", Settings.JumpPower)
    end)
    jumpHandle.InputEnded:Connect(function()
        sliderDragging = false
        currentSlider = nil
    end)

    maxHandle.InputBegan:Connect(function(input)
        startSlider(input, "max speed", Settings.MaxSpeed)
    end)
    maxHandle.InputEnded:Connect(function()
        sliderDragging = false
        currentSlider = nil
    end)

    accelHandle.InputBegan:Connect(function(input)
        startSlider(input, "boost", Settings.SpeedIncrease)
    end)
    accelHandle.InputEnded:Connect(function()
        sliderDragging = false
        currentSlider = nil
    end)

    UIS.InputChanged:Connect(function(input)
        if sliderDragging and currentSlider and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = Vector2.new(input.Position.X, input.Position.Y) - sliderStartPos
            local sliderBg
            local minVal, maxVal
            if currentSlider == "jump" then
                sliderBg = jumpSliderBg
                minVal = Settings.MinJumpPower
                maxVal = Settings.MaxJumpPower
            elseif currentSlider == "max speed" then
                sliderBg = maxSliderBg
                minVal = Settings.MinMaxSpeed
                maxVal = Settings.MaxMaxSpeed
            else
                sliderBg = accelSliderBg
                minVal = Settings.MinSpeedIncrease
                maxVal = Settings.MaxSpeedIncrease
            end
            local sliderWidth = sliderBg.AbsoluteSize.X
            if sliderWidth > 0 then
                local percent = (sliderStartValue - minVal) / (maxVal - minVal) + delta.X / sliderWidth
                percent = math.clamp(percent, 0, 1)
                local newValue = minVal + percent * (maxVal - minVal)
                if currentSlider == "jump" then
                    setJumpPower(newValue)
                elseif currentSlider == "max speed" then
                    setMaxSpeed(newValue)
                else
                    setSpeedIncrease(newValue)
                end
            end
        end
    end)

    print("GUI BHop создан")
end
--by squirt
-- ========== Shiftlock (отдельная кнопка) ==========

local function createShiftlockButton()
    -- Создаём ScreenGui для шифт-лока (в PlayerGui, чтобы работало везде)
    local ShiftlockGui = Instance.new("ScreenGui")
    ShiftlockGui.Name = "ShiftlockButton"
    ShiftlockGui.Parent = Player:WaitForChild("PlayerGui")
    ShiftlockGui.ResetOnSpawn = false
    ShiftlockGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    ShiftlockGui.DisplayOrder = 2000  -- выше чем меню BHop

    -- Кнопка
    local ImageButton = Instance.new("ImageButton")
    ImageButton.Name = "ShiftlockIcon"
    ImageButton.Parent = ShiftlockGui
    ImageButton.Active = true
    ImageButton.Draggable = true  -- можно перетаскивать
    ImageButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    ImageButton.BackgroundTransparency = 1.000
    ImageButton.Position = UDim2.new(0.92, 0, 0.55, 0)   -- справа, по центру
    ImageButton.Size = UDim2.new(0, 60, 0, 60)          -- размер можно подогнать
    ImageButton.SizeConstraint = Enum.SizeConstraint.RelativeXX
    ImageButton.Image = "http://www.roblox.com/asset/?id=182223762"  -- иконка замка

    -- ========== Логика шифт-лока (первый скрипт) ==========
    local MobileCameraFramework = {}
    local players = game:GetService("Players")
    local runservice = game:GetService("RunService")
    local CAS = game:GetService("ContextActionService")
    local player = players.LocalPlayer
    local character = player.Character or player.CharacterAdded:Wait()
    local root = character:WaitForChild("HumanoidRootPart")
    local humanoid = character.Humanoid
    local camera = workspace.CurrentCamera
    local button = ImageButton

    -- Видимость только на мобилках (можно убрать, если нужно)
    local uis = game:GetService("UserInputService")
    local ismobile = uis.TouchEnabled
    button.Visible = ismobile

    local states = {
        OFF = "rbxasset://textures/ui/mouseLock_off@2x.png",
        ON = "rbxasset://textures/ui/mouseLock_on@2x.png"
    }
    local MAX_LENGTH = 900000
    local active = false
    local ENABLED_OFFSET = CFrame.new(1.7, 0, 0)
    local DISABLED_OFFSET = CFrame.new(-1.7, 0, 0)
    local rootPos = Vector3.new(0,0,0)

    local function UpdatePos()
        if player.Character and player.Character:FindFirstChildOfClass"Humanoid" and player.Character:FindFirstChildOfClass"Humanoid".RootPart then
            rootPos = player.Character:FindFirstChildOfClass"Humanoid".RootPart.Position
        end
    end

    local function UpdateImage(STATE)
        button.Image = states[STATE]
    end

    local function UpdateAutoRotate(BOOL)
        if player.Character and player.Character:FindFirstChildOfClass"Humanoid" then
            player.Character:FindFirstChildOfClass"Humanoid".AutoRotate = BOOL
        end
    end

    local function GetUpdatedCameraCFrame()
        if workspace.CurrentCamera then
            return CFrame.new(rootPos, Vector3.new(workspace.CurrentCamera.CFrame.LookVector.X * MAX_LENGTH, rootPos.Y, workspace.CurrentCamera.CFrame.LookVector.Z * MAX_LENGTH))
        end
    end

    local function EnableShiftlock()
        UpdatePos()
        UpdateAutoRotate(false)
        UpdateImage("ON")
        if player.Character and player.Character:FindFirstChildOfClass"Humanoid" and player.Character:FindFirstChildOfClass"Humanoid".RootPart then
            player.Character:FindFirstChildOfClass"Humanoid".RootPart.CFrame = GetUpdatedCameraCFrame()
        end
        if workspace.CurrentCamera then
            workspace.CurrentCamera.CFrame = camera.CFrame * ENABLED_OFFSET
        end
    end

    local function DisableShiftlock()
        UpdatePos()
        UpdateAutoRotate(true)
        UpdateImage("OFF")
        if workspace.CurrentCamera then
            workspace.CurrentCamera.CFrame = camera.CFrame * DISABLED_OFFSET
        end
        pcall(function()
            if active then
                active:Disconnect()
                active = nil
            end
        end)
    end
--by squirt
    UpdateImage("OFF")
    active = false

    function ShiftLock()
        if not active then
            active = runservice.RenderStepped:Connect(function()
                EnableShiftlock()
            end)
        else
            DisableShiftlock()
        end
    end

    -- Привязка к кнопке
    button.MouseButton1Click:Connect(ShiftLock)

    -- ========== Второй скрипт (контроллер) ==========
    -- (Адаптирован, чтобы не конфликтовать)
    local Players = game:GetService("Players")
    local UserInputService = game:GetService("UserInputService")
    local Settings = UserSettings()
    local GameSettings = Settings.GameSettings
    local ShiftLockController = {}

    while not Players.LocalPlayer do wait() end
    local LocalPlayer = Players.LocalPlayer
    local Mouse = LocalPlayer:GetMouse()
    local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
    local IsShiftLockMode = true
    local IsShiftLocked = true
    local IsActionBound = false
    local IsInFirstPerson = false
--by squirt
    ShiftLockController.OnShiftLockToggled = Instance.new("BindableEvent")

    local function isShiftLockMode()
        return LocalPlayer.DevEnableMouseLock and GameSettings.ControlMode == Enum.ControlMode.MouseLockSwitch and LocalPlayer.DevComputerMovementMode ~= Enum.DevComputerMovementMode.ClickToMove and GameSettings.ComputerMovementMode ~= Enum.ComputerMovementMode.ClickToMove and LocalPlayer.DevComputerMovementMode ~= Enum.DevComputerMovementMode.Scriptable
    end

    if not UserInputService.TouchEnabled then
        IsShiftLockMode = isShiftLockMode()
    end

    local function onShiftLockToggled()
        IsShiftLocked = not IsShiftLocked
        ShiftLockController.OnShiftLockToggled:Fire()
    end

    local initialize = function()
        print("Shiftlock enabled")
    end

    function ShiftLockController:IsShiftLocked()
        return IsShiftLockMode and IsShiftLocked
    end

    function ShiftLockController:SetIsInFirstPerson(isInFirstPerson)
        IsInFirstPerson = isInFirstPerson
    end

    local function mouseLockSwitchFunc(actionName, inputState, inputObject)
        if IsShiftLockMode then
            onShiftLockToggled()
        end
    end

    local function disableShiftLock()
        IsShiftLockMode = false
        Mouse.Icon = ""
        if InputCn then
            InputCn:Disconnect()
            InputCn = nil
        end
        IsActionBound = false
        ShiftLockController.OnShiftLockToggled:Fire()
    end

    local onShiftInputBegan = function(inputObject, isProcessed)
        if isProcessed then return end
        if inputObject.UserInputType ~= Enum.UserInputType.Keyboard or inputObject.KeyCode == Enum.KeyCode.LeftShift or inputObject.KeyCode == Enum.KeyCode.RightShift then
            -- Ничего, можно добавить обработку клавиш, если нужно
        end
    end

    local function enableShiftLock()
        IsShiftLockMode = isShiftLockMode()
        if IsShiftLockMode then
            if IsShiftLocked then
                ShiftLockController.OnShiftLockToggled:Fire()
            end
            if not IsActionBound then
                InputCn = UserInputService.InputBegan:Connect(onShiftInputBegan)
                IsActionBound = true
            end
        end
    end
--by squirt
    GameSettings.Changed:Connect(function(property)
        if property == "ControlMode" then
            if GameSettings.ControlMode == Enum.ControlMode.MouseLockSwitch then
                enableShiftLock()
            else
                disableShiftLock()
            end
        elseif property == "ComputerMovementMode" then
            if GameSettings.ComputerMovementMode == Enum.ComputerMovementMode.ClickToMove then
                disableShiftLock()
            else
                enableShiftLock()
            end
        end
    end)

    LocalPlayer.Changed:Connect(function(property)
        if property == "DevEnableMouseLock" then
            if LocalPlayer.DevEnableMouseLock then
                enableShiftLock()
            else
                disableShiftLock()
            end
        elseif property == "DevComputerMovementMode" then
            if LocalPlayer.DevComputerMovementMode == Enum.DevComputerMovementMode.ClickToMove or LocalPlayer.DevComputerMovementMode == Enum.DevComputerMovementMode.Scriptable then
                disableShiftLock()
            else
                enableShiftLock()
            end
        end
    end)

    LocalPlayer.CharacterAdded:Connect(function(character)
        if not UserInputService.TouchEnabled then
            initialize()
        end
    end)

    if not UserInputService.TouchEnabled then
        initialize()
        if isShiftLockMode() then
            InputCn = UserInputService.InputBegan:Connect(onShiftInputBegan)
            IsActionBound = true
        end
    end

    enableShiftLock()

    print("Shiftlock button created")
end

-- ========== Обработка респавна ==========

local function onCharacterAdded(newChar)
    Character = newChar
    task.wait(0.5)
    if updateCharacterReferences() then
        if Settings.Enabled then
            Settings.Enabled = false
        end
        if button then
            button.Text = "BHop OFF"
            button.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        end
        Humanoid.WalkSpeed = Original.WalkSpeed
        Humanoid.JumpPower = Original.JumpPower
        Settings.CurrentSpeed = Original.WalkSpeed
        lastPosition = RootPart.Position
        lastTime = tick()
        peakSpeed = 0
        print("Персонаж возродился, BHop сброшен")
    end
end

Player.CharacterAdded:Connect(onCharacterAdded)

-- ========== Запуск ==========
--by squirt
createGUI()
createShiftlockButton()  -- добавляем кнопку шифт-лока

connection = game:GetService("RunService").Heartbeat:Connect(mainLoop)
--by squirt
print("Скрипт загружен. Меню BHop слева, кнопка Shiftlock справа (видна на мобилках).")
